sequenceDiagram
    autonumber
    participant POS as ðŸ§¾ POS / API Event
    participant Orchestrator as ðŸ§­ Orchestrator Service
    participant Rule as ðŸ§  Rule Engine
    participant Campaign as ðŸŽ Campaign Service
    participant Loyalty as ðŸ’° Loyalty Service
    participant Voucher as ðŸŽŸï¸ Voucher Service
    participant Order as ðŸ“¦ Order Service
    participant Ledger as ðŸ“˜ Ledger / Audit Log

    POS->>Orchestrator: EarningEvent {total_spent=150000, user_id, tenant_id}
    Orchestrator->>Rule: BatchEvaluate(Context)
    Rule-->>Orchestrator: Matched â†’ [campaign_id="CAMP-123"]
    Orchestrator->>Campaign: GetCampaign(CAMP-123)
    Campaign-->>Orchestrator: {reward_type=POINT/VOUCHER/FREE_ITEM, reward_value={...}}

    alt reward_type == POINT
        Orchestrator->>Loyalty: AddPoints(user_id, reward_value.points)
        Loyalty-->>Ledger: AddEntry(CREDIT, reward_value.points)
    else reward_type == VOUCHER
        Orchestrator->>Voucher: IssueVoucher(user_id, reward_value.campaign_id)
        Voucher-->>Ledger: Log issuance
    else reward_type == FREE_ITEM
        Orchestrator->>Order: AddRewardItem(user_id, reward_value.product_id)
        Order-->>Ledger: Record reward item
    end

    Orchestrator-->>POS: âœ… Success (campaigns executed)
